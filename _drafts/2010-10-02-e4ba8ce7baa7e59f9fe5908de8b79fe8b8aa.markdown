---
author: cloga0216
comments: true
date: 2010-10-02 15:24:11+00:00
layout: post
slug: '%e4%ba%8c%e7%ba%a7%e5%9f%9f%e5%90%8d%e8%b7%9f%e8%b8%aa'
title: 二级域名/子域跟踪
wordpress_id: 528
tags:
- 二级域名
---

这只改变了GATC的一行。因此，通过从配置文件的“检查状态”区域选择一个域名多个子域名，能自动做出需要的修改，如图7.12所示。下面解释了为什么需要这样修改以及如何实现这些修改。你也需要考虑过滤器来区分你的不同子域（在第8章中讨论）。




[![](http://www.cloga.info/wp-content/uploads/2010/10/7.12.png)](http://www.cloga.info/wp-content/uploads/2010/10/7.12.png)
图7.12  跟踪子域GATC的自动修改（异步代码）




Google Analytics使用第一方cookie，这意味着收集到的信息与完全符合资格的主机名相关——例如，www.cloga.info。只有完全符合资格的主机名能读取或设置它的第一方cookie。这是所有网络浏览器的一个内在安全机制。
子域是主域的一部分。在这个例子中，主域是cloga.info，因此www实际上是cloga.info的一个子域。子域的其他例子包括bbs.cloga.info，download.cloga.info等等。<!-- more -->
**注：**仅包含数字、文字或连字符的任何名称都可以用作子域名。当然，只有当你的DNS设置了之后，你才能使用子域。
当你设置Google Analytics之后，其域默认行为是在不同的配置文件中跟踪子域。也就是说，你在为新域添加配置文件的URL区域输入子域——如第6章的“账户及配置文件的使用”部分所述。这将为每个子域产生一段单独的跟踪代码，因此，确保你为网站添加了正确的代码。
因此，默认情况下，Google Analytics将在你的子域间跟踪为推介网站。例如，www.cloga.info变成了bbs.cloga.info的推介网站。这本身是一个有价值的信息，但是，原始的推介网站（例如，百度上的搜索关键词），这将在www.cloga.info中获得并报告，但是却无法传入的bbs.cloga.info的报告中。如果这是一笔交易，那么你将知道访问者找到了什么，但是却对你的客户如何找到你一无所知。
幸运的是，为你自己的域变改变这种行为非常简单。通过将你的子域数据汇总到一个主域下，就能做到这一点。在GATC中设置你的主域，这样Google Analytics的第一方cookie可以在你的子域间共享，如下所示：
旧的ga.js：
`<script type=“text/javascript”>
var gaJsHost = ((“https:” == document.location.protocol) ? “https://ssl.” :“http://www.”);
document.write(unescape(“%3Cscript src=‘” + gaJsHost + “google-analytics.com/ga.js’ type=‘text/javascript’%3E%3C/script%3E”));
</script>
<script type=“text/javascript”>
try {
var pageTracker = _gat._getTracker(“UA-12345-1”);
**pageTracker._setDomainName(“.cloga.info”);
**pageTracker._trackPageview();
} catch(err) {}</script>
`异步代码：
`<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12345-1']);
_**gaq.push(['_setDomainName','.cloga.info'])**
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);`
这样.cloga.info的所有子域都能读写或编辑Google Analytics使用的_utm cookie。不需要更多的GATC修改。但是，你可能意识到，所有的子域汇总到一起意味着，www.cloga.info/index.htm和bbs.cloga.info/index.htm的访问将在报告中显示为同一个页面——也就说，你不知道你的www网站为你的bbs网站引入了多少访问。通过应用过滤器可以避免这些，如图7.13所示。
**注：**图7.13所示的过滤器将使网站内点击量分布图失效，并且可能需要你相应修改你的目标设置。但是，我认为网站内点击量分布图的失去与应用这个过滤器所获得的更好的见解相比是微不足道的。




[![](http://www.cloga.info/wp-content/uploads/2010/10/7.13.png)](http://www.cloga.info/wp-content/uploads/2010/10/7.13.png)
图7.13  区分不同子域中相同名称页面的过滤器




通过使用这个过滤器，页面名称将包含子域，因为你可以区分子域，例如，在内容>热门报告中，www.cloga.info/index.htm与bbs.cloga.info/index.htm将分开。过滤器的使用将在第8章中详细讨论。
Cloga：这个过滤器使用时需要注意一个小技巧，在设置过滤器后，内容报告中的热门报告、最常见目标网页和最常见退出页中的[![](http://www.cloga.info/wp-content/uploads/2010/10/8-13-1.bmp)](http://www.cloga.info/wp-content/uploads/2010/10/8-13-1.bmp)查看此链接将无法使用。这是因为，默认情况下，查看此链接功能是将配置文件中网站网址与内容报告中的URI链接在一块产生一个完整的URL，而当用过滤器重写了URI，将主机名包含在URI中之后，将多出你在配置文件中设置的网站网址。比如，当设置以上的过滤器之后，你点击www.cloga.info/index.htm页面的查看此链接时，在浏览器地址输入的URL为[http://www.cloga.info/index.htmwww.cloga.info](http://www.cloga.info/index.htmwww.cloga.info)。为了能够正常使用查看此链接这个功能，你只需要将配置文件中的网站网址仅设置为：http://，这样这一功能就能正常使用。
**特别提示：**在GA的最新版帮助文件中，需要在setDomainName后添加_gaq.push(['_setAllowHash',false])，这句代码的作用是将所有域的域哈希设置强制设置为1，这样cookie就可以在多个子域间传递，你就不会在引介网站中，看到自己的域名了，这种方法也是许多GA资深专家所推荐的。




(Cloga,11.04.27)最初我对这里的理解有一些偏差，更正如下：_gaq.push(['_setAllowHash',false])这个方法用在跨域子域同时又跨主域的情况。在引荐来源中出现自身网站有两种情况：一、有些访问的Landing page没有GA代码；访问过程中出现的一些重定向。对于这种情况，最佳的方案是添加_gaq.push(['_addIgnoredRef', '.cloga.info'])忽略自身的引荐。







    
    _gaq.push(['_setAllowLinker',true]);
    



