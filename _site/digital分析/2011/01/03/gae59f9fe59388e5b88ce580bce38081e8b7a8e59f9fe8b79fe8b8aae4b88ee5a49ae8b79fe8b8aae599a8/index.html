
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="ujianVerification" content="fbba4ee9b28ec33f11f17698ddc55b92" />
    <link rel="stylesheet" href="/pygments.css">
    <title>GA域哈希值、跨域跟踪与多跟踪器</title>
    
    <meta name="author" content="Cloga Chen">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  
    <!--[if lt IE 9]>
      <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <script>
      dataLayer = [];
    </script>
  </head>

  <body>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Cloga的互联网笔记</a>
        </div>

        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          <li><a href="/about.html">关于Cloga</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      
<div class="page-header">
  <h1>GA域哈希值、跨域跟踪与多跟踪器 </h1>
</div>
<div class="row post-full">
  <div class="col-md-12">
    <div class="date">
      <span>03 January 2011</span>
    </div>
    <div class="content">
      <p><strong>GA域哈希值的介绍
*<em>域哈希值是GA用来代表你的网站的固定长度的数值。Google Analytics哈希值算法的运作机制，请见：
<a href="http://www.google.com/support/forum/p/Google+Analytics/thread?tid=626b0e277aaedc3c&amp;hl=en">http://www.google.com/support/forum/p/Google+Analytics/thread?tid=626b0e277aaedc3c&amp;hl=en</a>
默认情况下（未使用setDomainName()的情况下），GA会为每一个二级域名指定不同的域哈希值。如果使用setDomainName()的话，域哈希值会发生变化，
*</em>GA跨域跟踪的最佳实践</strong>
假如你的网站有多个子域，比如<a href="http://www.cloga.info">www.cloga.info</a>和bbs.cloga.info，如果你使用一个网络资源ID来跟踪这两个子域。默认情况下，GA会将这两个网站单独设置Cookie，每一个网站的访问数会单独计数，两个子域之间的链接会显示为引荐来源。
比如，访问者A从百度来到了<a href="http://www.cloga.info">www.cloga.info</a>，GA会记录到来自百度的一次访问，访问者A随后从<a href="http://www.cloga.info">www.cloga.info</a>的链接来到了bbs.cloga.info，GA会记录到来自<a href="http://www.cloga.info">www.cloga.info</a>的一次引荐访问（两个域的哈希值不同）。本来的一次访问会记录为两次访问。
如果你希望将cloga.info这个主域作为一个整体。则需要使用GA的跨域跟踪。GA跨域跟踪代码的实例如下：
<code>&lt;script type=&quot;text/javascript&quot;&gt;
 var _gaq = _gaq || [];
 _gaq.push([&#39;_setAccount&#39;, &#39;UA-18159656-1&#39;]);
 _gaq.push([&#39;_setDomainName&#39;,&#39;.cloga.info&#39;]);
 _gaq.push([&#39;_setAllowHash&#39;,false]);
 _gaq.push([&#39;_trackPageview&#39;]);
 (function() {
  var ga = document.createElement(&#39;script&#39;); ga.type = &#39;text/javascript&#39;; ga.async = true;
  ga.src = (&#39;https:&#39; == document.location.protocol ? &#39;https://ssl&#39; : &#39;http://www&#39;) + &#39;.google-analytics.com/ga.js&#39;;
  var s = document.getElementsByTagName(&#39;script&#39;)[0]; s.parentNode.insertBefore(ga, s);
 })();
&lt;/script&gt;
</code>这里比默认的跟踪代码多使用了两个函数：
setDomainName(“.cloga.info”)：设置主域名，主域名下的所有子域都可能共享cookie
setAllowHash(false)：关闭域哈希值，将域哈希值强制设置为1
GA跨域跟踪官方文档：
<a href="http://code.google.com/intl/zh-CN/apis/analytics/docs/tracking/gaTrackingSite.html">http://code.google.com/intl/zh-CN/apis/analytics/docs/tracking/gaTrackingSite.html</a>
这里有个比较邪恶的想法：可以通过在页面中进行使用setDomainName()与不使用setDomainName()的混搭来使GA跟踪到流量翻N倍，N决定于你的平均页面浏览深度。
*<em>GA多跟踪器的使用
*</em>异步的GA代码使用push数组的方式向GA服务器发送跟踪器对象方法名称及参数。其实其中包含一个名称为””的跟踪器（Tracker）。默认情况下，GA代码仅包含一个跟踪器。当需要为一个使用网站使用多个跟踪器（即使用多个网络资源ID收集同一个网站的数据）时，需要按照GA多跟踪器来部署GA。
仅使用默认单独GA代码跟踪单一二级域的流量信息时，可以简单将两段GA代码粘贴到网页源码中，也可以将两个跟踪器写在一个JS中，不需要为每个跟踪器单独指定名称。
但是当使用了进行了自定义设置（比如设定主域名称、虚拟综合浏览量和电子商务跟踪等）的GA代码跟踪时，需要为每个跟踪器指定名称。
因为不指定跟踪器名称，则JS会将最后一个push数据里的网络资源ID作为跟踪器的网络资源ID。使用虚拟页面浏览时，这个页面浏览的信息只会发送给最后一个网络资源ID。</p>

    </div>

    
      <ul class="tag_box inline">
        <li><i class="icon-folder-open"></i></li>
        
        


  
     
    	<li><a href="/categories.html#digital分析-ref">
    		digital分析 <span>32</span>
    	</a></li>
    
  


      </ul>
    

    
      <ul class="tag_box inline">
        <li><i class="icon-tags"></i></li>
        
        


  
     
    	<li><a href="/tags.html#多跟踪器-ref">多跟踪器 <span>1</span></a></li>
     
    	<li><a href="/tags.html#跨域跟踪-ref">跨域跟踪 <span>1</span></a></li>
    
  



      </ul>
    

    <hr>
    
    <ul class="pagination">
      
        <li class="prev"><a href="/%E5%BC%80%E6%BA%90%E7%BD%91%E7%AB%99%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/2010/12/26/piwik-e69687e6a1a3" title="Piwik-文档">&larr; 上一页</a></li>
      
        <li><a href="/archive.html">归档列表</a></li>
      
        <li class="next"><a href="/digital%E5%88%86%E6%9E%90/2011/01/09/gae5afb9e8aebfe997aee69da5e6ba90e79a84e588a4e696ad" title="GA对访问来源的判断">下一页 &rarr;</a></li>
      
    </ul>
    <hr>
    <!-- Paste the 3 next lines where you want the sharing button(s) to appear -->
    <div class="post-sharing">
     


  <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1654363" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1343300786690926" charset="utf-8"></script>
<!-- JiaThis Button END -->



    </div>    
    <div class="post-comments">
    


  <!-- UJian Button BEGIN -->
<div class="ujian-hook"></div>
<script type="text/javascript">var ujian_config = {num:12,picSize:84,textHeight:45};</script>
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?uid=1654363"></script>
<a href="http://www.ujian.cc" style="border:0;"><img src="http://img.ujian.cc/pixel.png" alt="友荐云推荐" style="border:0;padding:0;margin:0;" /></a>
<!-- UJian Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1654363"></script>
<!-- UY END -->



    </div>
  </div>
</div>


      <hr>
      <footer>
        <p>
          &copy; 2014 Cloga Chen
          <span class="pull-right text-muted">
            powered by
            <a href="http://jekyll-bootstrap-3.github.io" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll-Bootstrap-3</a>
            and <a href="http://getbootstrap.com" target="_blank">Twitter Bootstrap 3.0.3</a>
          </span>
        </p>
      </footer>
    </div>

    
    <script src="/assets/themes/bootstrap/resources/jquery/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-7VF4"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-7VF4');</script>
<!-- End Google Tag Manager -->


  </body>
</html>

