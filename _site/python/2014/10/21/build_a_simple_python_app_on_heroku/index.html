
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="ujianVerification" content="fbba4ee9b28ec33f11f17698ddc55b92" />
    <link rel="stylesheet" href="/pygments.css">
    <title>在Heroku上搭建简单的Python Web 应用</title>
    
    <meta name="author" content="Cloga Chen">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  
    <!--[if lt IE 9]>
      <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <script>
      dataLayer = [];
    </script>
  </head>

  <body>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Cloga的互联网笔记</a>
        </div>

        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          <li><a href="/about.html">关于Cloga</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      
<div class="page-header">
  <h1>在Heroku上搭建简单的Python Web 应用 </h1>
</div>
<div class="row post-full">
  <div class="col-md-12">
    <div class="date">
      <span>21 October 2014</span>
    </div>
    <div class="content">
      <p>开发一个小应用放在互联网上给大家使用是一件成就感很高的事情，不过支持Python的免费空间不是很多，虽然GAE支持Python，不过由于众所周知的原因，在国内是很难打开GAE，这篇文章为大家介绍一下<a href="https://www.heroku.com/">Heroku</a>，heroku是支持Python在数据量不大的情况下是免费。</p>

<h1>涉及到的工具</h1>

<ul>
<li><p><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">git</a>：分布式版本管理工具，这里推荐大家看一下<a href="(http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000)">廖雪峰的GIT教程</a></p></li>
<li><p><a href="http://www.virtualenv.org/en/latest/">Virtualenv</a>，Python的虚拟环境模块</p></li>
<li><p><a href="http://virtualenvwrapper.readthedocs.org/en/latest/">Virtualenvwrapper</a>，在Virtualenv之上封装了一些更简便的方法</p></li>
<li><p><a href="http://flask.pocoo.org/">Flask</a>，Python的web框架</p></li>
<li><p><a href="https://devcenter.heroku.com/articles/getting-started-with-python#set-up">Heroku Toolbelt</a>，Heroku提供的命令行工具</p></li>
</ul>

<h1>搭建本地的环境</h1>

<ul>
<li>安装Virtualenv和Virtualenvwrapper</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo pip install Virtualenv
sudo pip install Virtualenvwrapper
</code></pre></div>
<ul>
<li>安装之后需要在.bash_profile中添加如下两行代码：</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">export WORKON_HOME=$HOME/.virtualenvs
source /Library/Frameworks/Python.framework/Versions/2.7/bin/virtualenvwrapper.sh
</code></pre></div>
<p>这里source的路径可以通过：<code>which virtualenvwrapper.sh</code>来确定</p>

<ul>
<li><p>创建一个叫做toyapp的文件夹，用于存放这个项目相关的文件</p></li>
<li><p>进入toyapp，初始化一个git仓库</p></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">cd toyapp
git init
</code></pre></div>
<ul>
<li>用Virtualenvwrapper创建一个名为toyapp虚拟环境</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">mkvirtualenv toyapp
</code></pre></div>
<p>创建一个虚拟环境好处在于：每个App都有其依赖的特定版本Python模块，不同版本的模块可能导致App无法运行，而在本地的Python主环境中只能安装一个版本的模块，并且不同的App也并不会需要安装主环境中的所有模块。</p>

<p>通过虚拟环境，我们可以为不同的环境安装不同版本的模块，同时也可以为App只安装需要必须模块的纯净环境。</p>

<p>通过mkvirtualenv命令创建虚拟环境后会默认进行这个虚拟环境</p>

<ul>
<li>通过<a href="http://virtualenvwrapper.readthedocs.org/en/latest/scripts.html#scripts-postactivate">postactivate</a>文件添加一些进入虚拟环境的初始命令</li>
</ul>

<p>postactivate中的变量可以在运行workon(virtualenvwrapper提供的切换虚拟环境命令)后运行，比如，对于我们的项目，我们可以在postactivate添加cd命令，这样当我们切换到虚拟就可以进入到项目的目录中</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">vi $VIRTUAL_ENV/bin/postactivate
</code></pre></div>
<p>在虚拟环境中运行上面的命令，就可以编辑postactivate文件，在vim编辑器中，英文模式下输入i进入插入模式，添加cd 项目的路径，比如cd /Users/cloga/Documents/clogatoyapp，添加完毕后，按ESC键退出插入模式，英文模式下输入:wq保存修改并退出vim</p>

<p>用deactivate命令退出虚拟环境，再用workon toyapp命令进入虚拟环境，这时你会发现目录也会自动进入到项目的路径</p>

<ul>
<li>如果要删除一个虚拟环境，需要使用</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">deactivate
rmvirtualenv 虚拟环境
</code></pre></div>
<p>但是这个命令不会删除安装的模块，如果要删除所有按照的模块需要使用</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rm -r 虚拟环境的文件夹
</code></pre></div>
<p>比如对于我的情况，需要使用</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">rm -r /Users/cloga/.virtualenvs/toyapp/
</code></pre></div>
<h1>创建一个简单的Flask项目</h1>

<ul>
<li>安装Flask，并把当前环境中依赖的python模块输入到requirements.txt</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">pip install flask
pip freeze &gt; requirements.txt
</code></pre></div>
<p>requirements.txt里面记录了当前环境中安装的各种模块及其对应版本，当上传到Heroku时，Heroku会按照这个文件安装对应的模块，如果以后有新增的模块，也需要及时通过pip freeze命令将模块版本信息添加到这个文件中</p>

<ul>
<li>创建app.py，并在其中添加如下代码</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span>  <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<p>在terminal中运行 python app.py，这样一个最简单的Flask web app就开始运行了，访问http://localhost:5000/试一下吧</p>

<p>如果要关闭服务器，按CTRL+C</p>

<ul>
<li>简单解释一下app.py中的代码作用

<ol>
<li>首先，引入了Flask类</li>
<li>接下来创建了一个Flask类的实例。参数是这个模块或包的名称。当将app.py直接运行时_<em>name\</em>_等于__main__，如果将app作为一个模块引用则等于引用时为app指定的名字。Flask需要这个名字来了解去哪里查找模板，静态文件等等</li>
<li>用route修饰器来告诉Flask哪些URL应该触发下面方法</li>
<li>定义一个hello_world方法，当方法运行时返回‘Hello World!’字符串</li>
<li>最后是一个Python中很常见的用法，如果这个脚本文件是在python解释器直接运行则运行app()</li>
</ol></li>
</ul>

<p>所以简单来说，app.py的作用就是当有人访问/页面时返回‘Hello World!’字符串</p>

<h1>将项目部署到Heroku</h1>

<ul>
<li>注册<a href="https://www.heroku.com/">Herok账号</a></li>
</ul>

<p>免费的Heroku支持一个Dynos和10K以下记录的PgSQL</p>

<ul>
<li>下载并安装Heroku <a href="https://toolbelt.heroku.com/">Toolbelt</a></li>
</ul>

<p>Toolbelt提供了Heroku的命令行工具</p>

<ul>
<li>定义 Profile</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">touch Procfile
</code></pre></div>
<p>在其中输入以下语句</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">web:gunicorn app:app
</code></pre></div>
<p>Profile是一个在应用根目录的文本文件，用于声明用于启动应用的语句</p>

<p>上面的一行语句生命了一个单一的进程类型：web以及运行它需要的语句。Web在这里很重要，它表明这个进程类型将隶属于Heroku的HTTP路由栈，并且在部署时接受web流量</p>

<ul>
<li>安装gunicoin，并将版本信息计入requirements.txt</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">pip install gunicorn
pip freeze &gt; requirements.txt
</code></pre></div>
<ul>
<li>登陆Heroku</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">heroku login
</code></pre></div>
<p>输入用户名和密码</p>

<ul>
<li>在Heroku上创建一个App</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">heroku create toyapp
</code></pre></div>
<ul>
<li>将本地的App推送到Heroku上</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">git add -A
git commot -m &#39;init&#39;
git push heroku master
</code></pre></div>
<ul>
<li>你也可以为这个git库同时绑定一个github仓库</li>
</ul>

<p>假设你创建了一个名字为test的github仓库，那么你可以通过下面的代码将本地的代码库与远程的Github库关联</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git remote add origin https://github.com/cloga/test.git
</code></pre></div>
<p>通过<code>git push orgin master</code>，就可以将本地的代码库推送到github。</p>

<ul>
<li>enjoy你的第一个web app吧</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">heroku open
</code></pre></div>
<p>PS:我在Heroku上放了两个小项目：</p>

<p><a href="http://app.cloga.info/">生成页面标签云</a></p>

<p><a href="http://app.cloga.info/ca">对应分析</a></p>

    </div>

    
      <ul class="tag_box inline">
        <li><i class="icon-folder-open"></i></li>
        
        


  
     
    	<li><a href="/categories.html#python-ref">
    		python <span>17</span>
    	</a></li>
    
  


      </ul>
    

    
      <ul class="tag_box inline">
        <li><i class="icon-tags"></i></li>
        
        


  
     
    	<li><a href="/tags.html#python-ref">python <span>2</span></a></li>
     
    	<li><a href="/tags.html#heroku-ref">heroku <span>1</span></a></li>
    
  



      </ul>
    

    <hr>
    
    <ul class="pagination">
      
        <li class="prev"><a href="/python/2014/10/12/retriveing_ga_data_with_python" title="使用Python获取GA数据">&larr; 上一页</a></li>
      
        <li><a href="/archive.html">归档列表</a></li>
      
        <li class="next"><a href="/google%20tag%20manager/2014/12/13/GTM_use_case" title="Google Tag Manger的几个应用实例">下一页 &rarr;</a></li>
      
    </ul>
    <hr>
    <!-- Paste the 3 next lines where you want the sharing button(s) to appear -->
    <div class="post-sharing">
     


  <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1654363" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1343300786690926" charset="utf-8"></script>
<!-- JiaThis Button END -->



    </div>    
    <div class="post-comments">
    


  <!-- UJian Button BEGIN -->
<div class="ujian-hook"></div>
<script type="text/javascript">var ujian_config = {num:12,picSize:84,textHeight:45};</script>
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?uid=1654363"></script>
<a href="http://www.ujian.cc" style="border:0;"><img src="http://img.ujian.cc/pixel.png" alt="友荐云推荐" style="border:0;padding:0;margin:0;" /></a>
<!-- UJian Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1654363"></script>
<!-- UY END -->



    </div>
  </div>
</div>


      <hr>
      <footer>
        <p>
          &copy; 2014 Cloga Chen
          <span class="pull-right text-muted">
            powered by
            <a href="http://jekyll-bootstrap-3.github.io" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll-Bootstrap-3</a>
            and <a href="http://getbootstrap.com" target="_blank">Twitter Bootstrap 3.0.3</a>
          </span>
        </p>
      </footer>
    </div>

    
    <script src="/assets/themes/bootstrap/resources/jquery/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-7VF4"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-7VF4');</script>
<!-- End Google Tag Manager -->


  </body>
</html>

