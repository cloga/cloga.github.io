
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="ujianVerification" content="fbba4ee9b28ec33f11f17698ddc55b92" />
    <link rel="stylesheet" href="/pygments.css">
    <title>1.3NumPy：创建和操作数值数据</title>
    
    <meta name="author" content="Cloga Chen">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  
    <!--[if lt IE 9]>
      <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <script>
      dataLayer = [];
    </script>
  </head>

  <body>
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Cloga的互联网笔记</a>
        </div>

        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          <li><a href="/about.html">关于Cloga</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      
<div class="page-header">
  <h1>1.3NumPy：创建和操作数值数据 </h1>
</div>
<div class="row post-full">
  <div class="col-md-12">
    <div class="date">
      <span>31 December 2014</span>
    </div>
    <div class="content">
      <p>Cloga：这份文档是euroscipy关于Python科学计算资源的一个教程。英文版地址为：<a href="http://scipy-lectures.github.io/">http://scipy-lectures.github.io/</a>，是学习Python科学计算生态体系很好的资料，因此，我会陆续将它翻译为中文，相关Gitbub地址为：<a href="https://github.com/cloga/scipy-lecture-notes_cn">https://github.com/cloga/scipy-lecture-notes_cn</a>，<a href="http://cloga.info/python_scientific_lecture_notes/2014/12/14/python_scientific_lecture_notes_cn/">完整的中文目录</a></p>

<hr>

<p><a href="http://nbviewer.ipython.org/github/cloga/scipy-lecture-notes_cn/blob/master/1.3NumPy%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E4%BD%9C%E6%95%B0%E5%80%BC%E6%95%B0%E6%8D%AE.ipynb">本文的IPython版本</a></p>

<blockquote>
<p>作者：Emmanuelle Gouillart、Didrik Pinte、Gaël Varoquaux 和 Pauli Virtanen</p>
</blockquote>

<p>本章给出关于Numpy概述，Numpy是Python中高效数值计算的核心工具。</p>

<h2>1.3.1 Numpy 数组对象</h2>

<h3>1.3.1.1 什么是Numpy以及Numpy数组？</h3>

<h4>1.3.1.1.1 Numpy数组</h4>

<p><strong>Python对象：</strong></p>

<ul>
<li>高级数值对象：整数、浮点</li>
<li>容器：列表（无成本插入和附加），字典（快速查找）</li>
</ul>

<p><strong>Numpy提供：</strong></p>

<ul>
<li>对于多维度数组的Python扩展包</li>
<li>更贴近硬件（高效）</li>
<li>为科学计算设计（方便）</li>
<li>也称为<em>面向数组计算</em></li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3])
</code></pre></div>
<p>例如，数组包含：</p>

<ul>
<li>实验或模拟在离散时间阶段的值</li>
<li>测量设备记录的信号，比如声波</li>
<li>图像的像素、灰度或颜色</li>
<li>用不同X-Y-Z位置测量的3-D数据，例如MRI扫描</li>
</ul>

<p>...</p>

<p><strong>为什么有用：</strong>提供了高速数值操作的节省内存的容器。</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">L</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">10000 loops, best of 3: 93.7 µs per loop
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">100000 loops, best of 3: 2.16 µs per loop
</code></pre></div>
<h4>1.3.1.1.2 Numpy参考文档</h4>

<ul>
<li>线上: http://docs.scipy.org/</li>
<li>交互帮助:</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="err">?</span>
<span class="n">String</span> <span class="n">Form</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span>
<span class="n">Docstring</span><span class="p">:</span>
<span class="n">array</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span>
</code></pre></div>
<p>查找东西：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">lookfor</span><span class="p">(</span><span class="s">&#39;create array&#39;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Search results for &#39;create array&#39;
---------------------------------
numpy.array
    Create an array.
numpy.memmap
    Create a memory-map to an array stored in a *binary* file on disk.
numpy.diagflat
    Create a two-dimensional array with the flattened input as a diagonal.
numpy.fromiter
    Create a new 1-dimensional array from an iterable object.
numpy.partition
    Return a partitioned copy of an array.
numpy.ma.diagflat
    Create a two-dimensional array with the flattened input as a diagonal.
numpy.ctypeslib.as_array
    Create a numpy array from a ctypes array or a ctypes POINTER.
numpy.ma.make_mask
    Create a boolean mask from an array.
numpy.ctypeslib.as_ctypes
    Create and return a ctypes object from a numpy array.  Actually
numpy.ma.mrecords.fromarrays
    Creates a mrecarray from a (flat) list of masked arrays.
numpy.lib.format.open_memmap
    Open a .npy file as a memory-mapped array.
numpy.ma.MaskedArray.__new__
    Create a new masked array from scratch.
numpy.lib.arrayterator.Arrayterator
    Buffered iterator for big arrays.
numpy.ma.mrecords.fromtextfile
    Creates a mrecarray from data stored in the file `filename`.
numpy.asarray
    Convert the input to an array.
numpy.ndarray
    ndarray(shape, dtype=float, buffer=None, offset=0,
numpy.recarray
    Construct an ndarray that allows field access using attributes.
numpy.chararray
    chararray(shape, itemsize=1, unicode=False, buffer=None, offset=0,
numpy.pad
    Pads an array.
numpy.sum
    Sum of array elements over a given axis.
numpy.asanyarray
    Convert the input to an ndarray, but pass ndarray subclasses through.
numpy.copy
    Return an array copy of the given object.
numpy.diag
    Extract a diagonal or construct a diagonal array.
numpy.load
    Load arrays or pickled objects from ``.npy``, ``.npz`` or pickled files.
numpy.sort
    Return a sorted copy of an array.
numpy.array_equiv
    Returns True if input arrays are shape consistent and all elements equal.
numpy.dtype
    Create a data type object.
numpy.choose
    Construct an array from an index array and a set of arrays to choose from.
numpy.nditer
    Efficient multi-dimensional iterator object to iterate over arrays.
numpy.swapaxes
    Interchange two axes of an array.
numpy.full_like
    Return a full array with the same shape and type as a given array.
numpy.ones_like
    Return an array of ones with the same shape and type as a given array.
numpy.empty_like
    Return a new array with the same shape and type as a given array.
numpy.zeros_like
    Return an array of zeros with the same shape and type as a given array.
numpy.asarray_chkfinite
    Convert the input to an array, checking for NaNs or Infs.
numpy.diag_indices
    Return the indices to access the main diagonal of an array.
numpy.ma.choose
    Use an index array to construct a new array from a set of choices.
numpy.chararray.tolist
    a.tolist()
numpy.matlib.rand
    Return a matrix of random values with given shape.
numpy.savez_compressed
    Save several arrays into a single file in compressed ``.npz`` format.
numpy.ma.empty_like
    Return a new array with the same shape and type as a given array.
numpy.ma.make_mask_none
    Return a boolean mask of the given shape, filled with False.
numpy.ma.mrecords.fromrecords
    Creates a MaskedRecords from a list of records.
numpy.around
    Evenly round to the given number of decimals.
numpy.source
    Print or write to a file the source code for a Numpy object.
numpy.diagonal
    Return specified diagonals.
numpy.histogram2d
    Compute the bi-dimensional histogram of two data samples.
numpy.fft.ifft
    Compute the one-dimensional inverse discrete Fourier Transform.
numpy.fft.ifftn
    Compute the N-dimensional inverse discrete Fourier Transform.
numpy.busdaycalendar
    A business day calendar object that efficiently stores information
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">con</span><span class="o">*</span><span class="err">?</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span>
<span class="n">np</span><span class="o">.</span><span class="n">conj</span>
<span class="n">np</span><span class="o">.</span><span class="n">conjugate</span>
<span class="n">np</span><span class="o">.</span><span class="n">convolve</span>
</code></pre></div>
<h4>1.3.1.1.3 导入惯例</h4>

<p>导入numpy的推荐惯例是：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</code></pre></div>
<h3>1.3.1.2 创建数组</h3>

<h4>1.3.1.2.1 手动构建数组</h4>

<ul>
<li>1-D：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">ndim</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(4,)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">4
</code></pre></div>
<ul>
<li>2-D，3-D，...：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>    <span class="c"># 2 x 3 数组</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[0, 1, 2],
       [3, 4, 5]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span><span class="o">.</span><span class="n">ndim</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">2
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(2, 3)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>     <span class="c"># 返回一个纬度的大小</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">2
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">]]])</span>
<span class="n">c</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[[1],
        [2]],

       [[3],
        [4]]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(2, 2, 1)
</code></pre></div>
<p><strong>练习：简单数组</strong></p>

<ul>
<li>创建一个简单的二维数组。首先，重复上面的例子。然后接着你自己的：在第一行从后向前数奇数，接着第二行数偶数？</li>
<li>在这些数组上使用函数<a href="http://docs.python.org/2.7/library/functions.html#len">len()</a>、numpy
.shape()。他们有什么关系？与数组的<code>ndim</code>属性间呢？</li>
</ul>

<h4>1.3.1.2.2 创建数组的函数</h4>

<p>实际上，我们很少一个项目接一个项目输入...</p>

<ul>
<li>均匀分布：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># 0 .. n-1  (!)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c"># 开始，结束（不包含），步长</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 3, 5, 7])
</code></pre></div>
<ul>
<li>或者通过一些数据点：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>   <span class="c"># 起点、终点、数据点</span>
<span class="n">c</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0. ,  0.2,  0.4,  0.6,  0.8,  1. ])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">d</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0. ,  0.2,  0.4,  0.6,  0.8])
</code></pre></div>
<ul>
<li>普通数组：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c"># 提示: (3, 3) 是元组</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 1.,  1.,  1.],
       [ 1.,  1.,  1.],
       [ 1.,  1.,  1.]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0.,  0.],
       [ 0.,  0.]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">c</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 1.,  0.,  0.],
       [ 0.,  1.,  0.],
       [ 0.,  0.,  1.]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span>
<span class="n">d</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1, 0, 0, 0],
       [0, 2, 0, 0],
       [0, 0, 3, 0],
       [0, 0, 0, 4]])
</code></pre></div>
<ul>
<li><code>np.random</code>: 随机数 (Mersenne Twister PRNG) :</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>       <span class="c"># [0, 1] 的均匀分布</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0.05504731,  0.38154156,  0.39639478,  0.22379146])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>      <span class="c"># 高斯</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0.9895903 ,  1.85061188,  1.0021666 , -0.63782069])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>        <span class="c"># 设置随机种子</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">np.random.rand?
</code></pre></div>
<p><strong>练习：用函数创建数组</strong>
* 实验用<code>arange</code>、<code>linspace</code>、<code>ones</code>、<code>zeros</code>、<code>eye</code>和<code>diag</code>。
* 用随机数创建不同类型的数组。
* 在创建带有随机数的数组前设定种子。
* 看一下函数<code>np.empty</code>。它能做什么？什么时候会比较有用？</p>

<h3>1.3.1.3基础数据类型</h3>

<p>你可能已经发现，在一些情况下，数组元素显示带有点（即 2. VS 2）。这是因为所使用的数据类型不同：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;int64&#39;)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 1.,  2.,  3.])
</code></pre></div>
<p>不同的数据类型可以更紧凑的在内存中存储数据，但是大多数时候我们都只是操作浮点数据。注意，在上面的例子中，Numpy自动从输入中识别了数据类型。</p>

<p>你可以明确的指定想要的类型：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;float64&#39;)
</code></pre></div>
<p><strong>默认</strong>数据类型是浮点:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;float64&#39;)
</code></pre></div>
<p>其他类型：</p>

<p><strong>复数</strong>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">+</span><span class="mi">2j</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="mi">4j</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="mi">1j</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;complex128&#39;)
</code></pre></div>
<p><strong>布尔</strong>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">])</span>
<span class="n">e</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;bool&#39;)
</code></pre></div>
<p><strong>字符</strong>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;Bonjour&#39;</span><span class="p">,</span> <span class="s">&#39;Hello&#39;</span><span class="p">,</span> <span class="s">&#39;Hallo&#39;</span><span class="p">,])</span>
<span class="n">f</span><span class="o">.</span><span class="n">dtype</span>     <span class="c"># &lt;--- 包含最多7个字母的字符</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;S7&#39;)
</code></pre></div>
<p><strong>更多</strong>：</p>

<ul>
<li>int32</li>
<li>int64</li>
<li>unit32</li>
<li>unit64</li>
</ul>

<h3>1.3.1.4基本可视化</h3>

<p>现在我们有了第一个数组，我们将要进行可视化。</p>

<p>从<em>pylab</em>模式启动IPython。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ipython --pylab
</code></pre></div>
<p>或notebook：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ipython notebook --pylab=inline
</code></pre></div>
<p>或者如果IPython已经启动，那么：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">pylab</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Using matplotlib backend: MacOSX
Populating the interactive namespace from numpy and matplotlib
</code></pre></div>
<p>或者从Notebook中：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">pylab</span> <span class="n">inline</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Populating the interactive namespace from numpy and matplotlib
</code></pre></div>
<p><code>inline</code> 对notebook来说很重要，以便绘制的图片在notebook中显示而不是在新窗口显示。</p>

<p><em>Matplotlib</em>是2D制图包。我们可以像下面这样导入它的方法：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>  <span class="c">#整洁形式</span>
</code></pre></div>
<p>然后使用（注你需要显式的使用 <code>show</code> ）:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>       <span class="c"># 线图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>           <span class="c"># &lt;-- 显示图表（使用pylab的话不需要）</span>
</code></pre></div>
<p>或者，如果你使用 <code>pylab</code>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>       <span class="c"># 线图</span>
</code></pre></div>
<p>在脚本中推荐使用 <code>import matplotlib.pyplot as plt</code>。 而交互的探索性工作中用 <code>pylab</code>。</p>

<ul>
<li>1D作图：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>       <span class="c"># 线图</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">[&lt;matplotlib.lines.Line2D at 0x1068f38d0&gt;]
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_63_1.png" alt="png"></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>  <span class="c"># 点图</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">[&lt;matplotlib.lines.Line2D at 0x106b32090&gt;]
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_64_1.png" alt="png"></p>

<ul>
<li>2D 作图:</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>    
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.colorbar.Colorbar instance at 0x106a095f0&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_66_1.png" alt="png"></p>

<p>更多请见matplotlib部分（暂缺）</p>

<p><strong>练习</strong>：简单可视化</p>

<p>画出简单的数组：cosine作为时间的一个函数以及2D矩阵。</p>

<p>在2D矩阵上试试使用 <code>gray</code> colormap。</p>

<h4>1.3.1.5索引和切片</h4>

<p>数组的项目可以用与其他Python序列（比如：列表）一样的方式访问和赋值：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(0, 2, 9)
</code></pre></div>
<p><strong>警告</strong>：索引从0开始与其他的Python序列（以及C/C++）一样。相反，在Fortran或者Matlab索引从1开始。</p>

<p>使用常用的Python风格来反转一个序列也是支持的：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([9, 8, 7, 6, 5, 4, 3, 2, 1, 0])
</code></pre></div>
<p>对于多维数组，索引是整数的元组：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[0, 0, 0],
       [0, 1, 0],
       [0, 0, 2]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="c"># 第三行，第二列</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0,  0,  0],
       [ 0,  1,  0],
       [ 0, 10,  2]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 0])
</code></pre></div>
<p><strong>注</strong>：</p>

<ul>
<li>在2D数组中，第一个纬度对应行，第二个纬度对应列。</li>
<li>对于多维度数组 <code>a</code>，a[0]被解释为提取在指定纬度的所有元素</li>
</ul>

<p><strong>切片</strong>：数组与其他Python序列也可以被切片：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c"># [开始:结束:步长]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([2, 5, 8])
</code></pre></div>
<p>注意最后一个索引是不包含的！：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3])
</code></pre></div>
<p>切片的三个元素都不是必选：默认情况下，起点是0，结束是最后一个，步长是1：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 2])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 2, 4, 6, 8])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([3, 4, 5, 6, 7, 8, 9])
</code></pre></div>
<p>Numpy索引和切片的一个小说明...</p>

<p><img src="http://scipy-lectures.github.io/_images/numpy_indexing.png" alt="numpy_indexing"></p>

<p>赋值和切片可以结合在一起：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0,  1,  2,  3,  4, 10, 10, 10, 10, 10])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 4, 4, 3, 2, 1, 0])
</code></pre></div>
<p><strong>练习：索引与切片</strong>
* 试试切片的特色，用起点、结束和步长：从linspace开始，试着从后往前获得奇数，从前往后获得偶数。
重现上面示例中的切片。你需要使用下列表达式创建这个数组：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">10</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0,  1,  2,  3,  4,  5],
       [10, 11, 12, 13, 14, 15],
       [20, 21, 22, 23, 24, 25],
       [30, 31, 32, 33, 34, 35],
       [40, 41, 42, 43, 44, 45],
       [50, 51, 52, 53, 54, 55]])
</code></pre></div>
<p><strong>练习：数组创建</strong></p>

<p>创建下列的数组（用正确的数据类型）：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[[1, 1, 1, 1],
 [1, 1, 1, 1],
 [1, 1, 1, 2],
 [1, 6, 1, 1]]

[[0., 0., 0., 0., 0.],
 [2., 0., 0., 0., 0.],
 [0., 3., 0., 0., 0.],
 [0., 0., 4., 0., 0.],
 [0., 0., 0., 5., 0.],
 [0., 0., 0., 0., 6.]]
</code></pre></div>
<p>参考标准：每个数组</p>

<p>提示：每个数组元素可以像列表一样访问，即a[1] 或 a[1, 2]。</p>

<p>提示：看一下 <code>diag</code> 的文档字符串。</p>

<p><strong>练习：创建平铺数组</strong></p>

<p>看一下 <code>np.tile</code> 的文档，是用这个函数创建这个数组：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</code></pre></div>
<h3>1.3.1.6 副本和视图</h3>

<p>切片操作创建原数组的一个<strong>视图</strong>，这只是访问数组数据一种方式。因此，原始的数组并不是在内存中复制。你可以用 <code>np.may_share_memory()</code>
来确认两个数组是否共享相同的内存块。但是请注意，这种方式使用启发式，可能产生漏报。</p>

<p>**当修改视图时，原始数据也被修改：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 2, 4, 6, 8])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">may_share_memory</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">True
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([12,  2,  4,  6,  8])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span>   <span class="c"># (!)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([12,  1,  2,  3,  4,  5,  6,  7,  8,  9])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c"># 强制复制</span>
<span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">may_share_memory</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">False
</code></pre></div>
<p>乍看之下这种行为可能有些奇怪，但是这样做节省了内存和时间。</p>

<p><strong>实例：素数筛选</strong></p>

<p><img src="http://scipy-lectures.github.io/_images/prime-sieve.png" alt="prime"></p>

<p>用筛选法计算0-99之间的素数</p>

<ul>
<li>构建一个名为 <code>_prime</code> 形状是 (100,) 的布尔数组，在初始将值都设为True：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">is_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>将不属于素数的0，1去掉</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">is_prime</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>
<p>对于从2开始的整数 <code>j</code> ，化掉它的倍数：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">N_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">is_prime</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N_max</span><span class="p">):</span>
    <span class="n">is_prime</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="p">::</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div>
<ul>
<li>看一眼 <code>help(np.nonzero)</code>，然后打印素数</li>
<li>接下来:

<ul>
<li>将上面的代码放入名为 <code>prime_sieve.py</code> 的脚本文件</li>
<li>运行检查一下时候有效</li>
<li>使用<a href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">埃拉托斯特尼筛法</a>的优化建议

<ol>
<li>跳过已知不是素数的 <code>j</code></li>
<li>第一个应该被划掉的数是$j^2$</li>
</ol></li>
</ul></li>
</ul>

<h4>1.3.1.7象征索引</h4>

<p>Numpy数组可以用切片索引，也可以用布尔或整形数组（面具）。这个方法也被称为象征索引。它创建一个副本而不是视图。</p>

<h4>1.3.1.7.1使用布尔面具</h4>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([10,  3,  8,  0, 19, 10, 11,  9, 10,  6,  0, 20, 12,  7, 14])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([False,  True, False,  True, False, False, False,  True, False,
        True,  True, False,  True, False, False], dtype=bool)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">extract_from_a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="c"># 或,  a[a%3==0]</span>
<span class="n">extract_from_a</span>           <span class="c"># 用面具抽取一个子数组</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 3,  0,  9,  6,  0, 12])
</code></pre></div>
<p>赋值给子数组时，用面具索引非常有用：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([10, -1,  8, -1, 19, 10, 11, -1, 10, -1, -1, 20, -1,  7, 14])
</code></pre></div>
<h4>1.3.1.7.2 用整型数组索引</h4>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0, 10, 20, 30, 40, 50, 60, 70, 80, 90])
</code></pre></div>
<p>索引可以用整型数组完成，其中相同的索引重复了几次：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>  <span class="c"># 注：[2, 3, 2, 4, 2] 是Python列表</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([20, 30, 20, 40, 20])
</code></pre></div>
<p>用这种类型的索引可以分配新值：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([   0,   10,   20,   30,   40,   50,   60, -100,   80, -100])
</code></pre></div>
<p>当一个新数组用整型数组索引创建时，新数组有相同的形状，而不是整数数组：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>
<span class="n">idx</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(2, 2)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[3, 4],
       [9, 7]])
</code></pre></div>
<p>下图展示了多种象征索引的应用
<img src="http://scipy-lectures.github.io/_images/numpy_fancy_indexing.png" alt="numpy_fancy_indexing"></p>

<p><strong>练习：象征索引</strong>
* 同样，重新生成上图中所示的象征索引
* 用左侧的象征索引和右侧的数组创建在为一个数组赋值，例如，设置上图数组的一部分为0。</p>

<h2>1.3.2 数组的数值操作</h2>

<h3>1.3.2.1 元素级操作</h3>

<h4>1.3.2.1.1 基础操作</h4>

<p>标量:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([2, 3, 4, 5])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="mi">2</span><span class="o">**</span><span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 2,  4,  8, 16])
</code></pre></div>
<p>所有运算是在元素级别上操作：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([-1.,  0.,  1.,  2.])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 2.,  4.,  6.,  8.])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 2,  3,  6, 13, 28])
</code></pre></div>
<p>这些操作当然也比你用纯Python实现好快得多：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">100000 loops, best of 3: 11 µs per loop
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">l</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1000 loops, best of 3: 560 µs per loop
</code></pre></div>
<p><strong>注意：数组相乘不是矩阵相乘：</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">c</span> <span class="o">*</span> <span class="n">c</span>                   <span class="c"># 不是矩阵相乘！</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 1.,  1.,  1.],
       [ 1.,  1.,  1.],
       [ 1.,  1.,  1.]])
</code></pre></div>
<p><strong>注：矩阵相乘：</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 3.,  3.,  3.],
       [ 3.,  3.,  3.],
       [ 3.,  3.,  3.]])
</code></pre></div>
<p><strong>练习：元素级别的操作</strong></p>

<ul>
<li>试一下元素级别的简单算术操作</li>
<li>用 <code>%timeit</code> 比一下他们与纯Python对等物的时间</li>
<li>生成：

<ul>
<li><code>[2**0, 2**1, 2**2, 2**3, 2**4]</code></li>
<li><code>a_j = 2^(3*j) - j</code></li>
</ul></li>
</ul>

<h4>1.3.2.1.2其他操作</h4>

<p><strong>对比：</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([False,  True, False,  True], dtype=bool)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([False, False,  True, False], dtype=bool)
</code></pre></div>
<p>数组级别的对比：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">False
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">True
</code></pre></div>
<p><strong>逻辑操作</strong>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ True,  True,  True, False], dtype=bool)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ True, False, False, False], dtype=bool)
</code></pre></div>
<p><strong><a href="http://baike.baidu.com/link?url=3aAGiGcMZFhxRP7D1CWzajcHf-OVCM6L6J1Eaxv1rPxFyEYKRoHXHdcYqKfUIc0q-hcxB_UoE73B5O0GyH1mf_">超越函数</a></strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0.        ,  0.84147098,  0.90929743,  0.14112001, -0.7568025 ])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">-c:1: RuntimeWarning: divide by zero encountered in log
array([       -inf,  0.        ,  0.69314718,  1.09861229,  1.38629436])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([  1.        ,   2.71828183,   7.3890561 ,  20.08553692,  54.59815003])
</code></pre></div>
<p><strong>形状不匹配</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>  
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

&lt;ipython-input-74-82c1c1d5b8c1&gt; in &lt;module&gt;()
      1 a = np.arange(4)
----&gt; 2 a + np.array([1, 2])


ValueError: operands could not be broadcast together with shapes (4,) (2,) 
</code></pre></div>
<p><em>广播</em>？我们将在<a href="#Broadcasting">稍后</a>讨论。</p>

<p><strong>变换</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>   <span class="c"># 看一下 help(np.triu)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0.,  1.,  1.],
       [ 0.,  0.,  1.],
       [ 0.,  0.,  0.]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">T</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0.,  0.,  0.],
       [ 1.,  0.,  0.],
       [ 1.,  1.,  0.]])
</code></pre></div>
<p><strong>警告：变换是视图</strong></p>

<p>因此，下列的代码是错误的，将导致矩阵不对称：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>
<p><strong>注：线性代数</strong></p>

<p>子模块 <code>numpy.linalg</code> 实现了基础的线性代数，比如解开线性系统，奇异值分解等。但是，并不能保证以高效的方式编译，因此，建议使用
<code>scipy.linalg</code>, 详细的内容见线性代数操作：<code>scipy.linalg</code>（暂缺）。</p>

<p><strong>练习：其他操作</strong>
* 看一下 <code>np.allclose</code> 的帮助，什么时候这很有用？
* 看一下 <code>np.triu</code>和 <code>np.tril</code>的帮助。</p>

<h3>1.3.2.2 基础简化</h3>

<h4>1.3.2.2.1 计算求和</h4>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">10
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">10
</code></pre></div>
<p>行求和和列求和：</p>

<p><img src="http://scipy-lectures.github.io/_images/reductions.png" alt="reductions"></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="n">x</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1, 1],
       [2, 2]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># 列 (第一纬度)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([3, 3])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(3, 3)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c"># 行 (第二纬度)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([2, 4])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(2, 4)
</code></pre></div>
<p>相同的思路在高维：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1.2671177193964822
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>     
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1.2671177193964822
</code></pre></div>
<h4>1.3.2.2.2 其他简化</h4>

<ul>
<li>以相同方式运作（也可以使用 <code>axis=</code> ）</li>
</ul>

<p><strong>极值</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">3
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c"># 最小值的索引</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">0
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>  <span class="c"># 最大值的索引</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1
</code></pre></div>
<p><strong>逻辑运算</strong>：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">False
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">True
</code></pre></div>
<p><strong>注</strong>：可以被应用数组对比：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">False
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">True
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="p">((</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">True
</code></pre></div>
<p><strong>统计:</strong></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1.75
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1.5
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 最后的坐标轴</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 2.,  5.])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>          <span class="c"># 全体总体的标准差。</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">0.82915619758884995
</code></pre></div>
<p>... 以及其他更多（随着你成长最好学习一下）。</p>

<p><strong>练习：简化</strong></p>

<ul>
<li>假定有 <code>sum</code> ，你会期望看到哪些其他的函数？</li>
<li><code>sum</code> 和 <code>cumsum</code> 有什么区别？</li>
</ul>

<p><strong>实例: 数据统计</strong></p>

<p><a href="http://scipy-lectures.github.io/_downloads/populations.txt">populations.txt</a>中的数据描述了过去20年加拿大北部野兔和猞猁的数量（以及胡萝卜）。</p>

<p>你可以在编辑器或在IPython看一下数据（shell或者notebook都可以）：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cat data/populations.txt
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text"># year  hare    lynx    carrot
1900    30e3    4e3 48300
1901    47.2e3  6.1e3   48200
1902    70.2e3  9.8e3   41500
1903    77.4e3  35.2e3  38200
1904    36.3e3  59.4e3  40600
1905    20.6e3  41.7e3  39800
1906    18.1e3  19e3    38600
1907    21.4e3  13e3    42300
1908    22e3    8.3e3   44500
1909    25.4e3  9.1e3   42100
1910    27.1e3  7.4e3   46000
1911    40.3e3  8e3 46800
1912    57e3    12.3e3  43800
1913    76.6e3  19.5e3  40900
1914    52.3e3  45.7e3  39400
1915    19.5e3  51.1e3  39000
1916    11.2e3  29.7e3  36700
1917    7.6e3   15.8e3  41800
1918    14.6e3  9.7e3   43300
1919    16.2e3  10.1e3  41300
1920    24.7e3  8.6e3   47300
</code></pre></div>
<p>首先，将数据加载到Numpy数组：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;data/populations.txt&#39;</span><span class="p">)</span>
<span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c"># 技巧: 将列分配给变量</span>
</code></pre></div>
<p>接下来作图：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Hare&#39;</span><span class="p">,</span> <span class="s">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.legend.Legend at 0x1070407d0&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_200_1.png" alt="png"></p>

<p>随时间变化的人口平均数：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">populations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="n">populations</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 34080.95238095,  20166.66666667,  42400.        ])
</code></pre></div>
<p>样本的标准差：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">populations</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 20897.90645809,  16254.59153691,   3322.50622558])
</code></pre></div>
<p>每一年哪个物种有最高的人口？：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">populations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([2, 2, 0, 0, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0, 1, 2, 2, 2, 2, 2])
</code></pre></div>
<p><strong>实例：随机游走算法扩散</strong></p>

<p><a href="http://scipy-lectures.github.io/_images/random_walk.png">random_walk</a></p>

<p>让我们考虑一下简单的1维随机游走过程：在每个时间点，行走者以相等的可能性跳到左边或右边。我们感兴趣的是找到随机游走者在 <code>t</code> 次左跳或右跳后距离原点的典型距离
？我们将模拟许多”行走者“来找到这个规律，并且我们将采用数组计算技巧来计算：我们将创建一个2D数组记录事实，一个方向是经历（每个行走者有一个经历），一个纬度是时间：</p>

<p><img src="http://scipy-lectures.github.io/_images/random_walk_schema.png" alt="random_walk_schema"></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">n_stories</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># 行走者的数</span>
<span class="n">t_max</span> <span class="o">=</span> <span class="mi">200</span>      <span class="c"># 我们跟踪行走者的时间</span>
</code></pre></div>
<p>我们随机选择步长1或-1去行走：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
<span class="n">steps</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n_stories</span><span class="p">,</span> <span class="n">t_max</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="c"># 验证: 所有步长是1或-1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([-1,  1])
</code></pre></div>
<p>我们通过汇总随着时间的步骤来构建游走</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># axis = 1: 纬度是时间</span>
<span class="n">sq_distance</span> <span class="o">=</span> <span class="n">positions</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div>
<p>获得经历轴的平均数：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">mean_sq_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sq_distance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>画出结果：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_sq_distance</span><span class="p">),</span> <span class="s">&#39;g.&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;y-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&quot;$t$&quot;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&quot;$\sqrt{\langle (\delta x)^2 \rangle}$&quot;</span><span class="p">)</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.text.Text at 0x10b529450&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_216_1.png" alt="png"></p>

<p>我们找到了物理学上一个著名的结果：均方差记录是时间的平方根！</p>

<p><a id='Broadcasting'></a></p>

<h3>1.3.2.3 广播</h3>

<ul>
<li>numpy数组的基本操作（相加等）是元素级别的</li>
<li>在相同大小的数组上仍然适用。
<strong>尽管如此</strong>, 也可能在不同大小的数组上进行这个操作，假如Numpy可以将这些数组转化为相同的大小：这种转化称为广播。</li>
</ul>

<p>下图给出了一个广播的例子：</p>

<p><img src="http://scipy-lectures.github.io/_images/numpy_broadcasting.png" alt="numpy_broadcasting"></p>

<p>让我们验证一下：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0,  0,  0],
       [10, 10, 10],
       [20, 20, 20],
       [30, 30, 30]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0,  1,  2],
       [10, 11, 12],
       [20, 21, 22],
       [30, 31, 32]])
</code></pre></div>
<p>在不知道广播的时候已经使用过它！：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c"># 我们将一个数组的纬度0分配给另一个数组的纬度1</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 2.,  2.,  2.,  2.,  2.],
       [ 1.,  1.,  1.,  1.,  1.],
       [ 1.,  1.,  1.,  1.,  1.],
       [ 1.,  1.,  1.,  1.,  1.]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">print</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c"># 我们将一个数组的纬度0分配给另一个数组的纬度</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">[ 1.  1.  1.  1.  1.]

array([[ 2.,  2.,  2.,  2.,  2.],
       [ 1.,  1.,  1.,  1.,  1.],
       [ 1.,  1.,  1.,  1.,  1.],
       [ 1.,  1.,  1.,  1.,  1.]])
</code></pre></div>
<p>一个有用的技巧：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(4,)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c"># 添加一个新的轴 -&gt; 2D 数组</span>
<span class="n">a</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(4, 1)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0],
       [10],
       [20],
       [30]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0,  1,  2],
       [10, 11, 12],
       [20, 21, 22],
       [30, 31, 32]])
</code></pre></div>
<p>广播看起来很神奇，但是，当我们要解决的问题是输出数据比输入数据有更多纬度的数组时，使用它是非常自然的。</p>

<p><strong>实例：广播</strong></p>

<p>让我们创建一个66号公路上城市之间距离（用公里计算）的数组：芝加哥、斯普林菲尔德、圣路易斯、塔尔萨、俄克拉何马市、阿马里洛、圣塔菲、阿尔布开克、Flagstaff、洛杉矶。</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">mileposts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">736</span><span class="p">,</span> <span class="mi">871</span><span class="p">,</span> <span class="mi">1175</span><span class="p">,</span> <span class="mi">1475</span><span class="p">,</span> <span class="mi">1544</span><span class="p">,</span> <span class="mi">1913</span><span class="p">,</span> <span class="mi">2448</span><span class="p">])</span>
<span class="n">distance_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mileposts</span> <span class="o">-</span> <span class="n">mileposts</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<span class="n">distance_array</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[   0,  198,  303,  736,  871, 1175, 1475, 1544, 1913, 2448],
       [ 198,    0,  105,  538,  673,  977, 1277, 1346, 1715, 2250],
       [ 303,  105,    0,  433,  568,  872, 1172, 1241, 1610, 2145],
       [ 736,  538,  433,    0,  135,  439,  739,  808, 1177, 1712],
       [ 871,  673,  568,  135,    0,  304,  604,  673, 1042, 1577],
       [1175,  977,  872,  439,  304,    0,  300,  369,  738, 1273],
       [1475, 1277, 1172,  739,  604,  300,    0,   69,  438,  973],
       [1544, 1346, 1241,  808,  673,  369,   69,    0,  369,  904],
       [1913, 1715, 1610, 1177, 1042,  738,  438,  369,    0,  535],
       [2448, 2250, 2145, 1712, 1577, 1273,  973,  904,  535,    0]])
</code></pre></div>
<p><img src="http://scipy-lectures.github.io/_images/route66.png" alt="route66"></p>

<p>许多基于网格或者基于网络的问题都需要使用广播。例如，如果要计算10X10网格中每个点到原点的数据，可以这样：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">distance</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0.        ,  1.        ,  2.        ,  3.        ,  4.        ],
       [ 1.        ,  1.41421356,  2.23606798,  3.16227766,  4.12310563],
       [ 2.        ,  2.23606798,  2.82842712,  3.60555128,  4.47213595],
       [ 3.        ,  3.16227766,  3.60555128,  4.24264069,  5.        ],
       [ 4.        ,  4.12310563,  4.47213595,  5.        ,  5.65685425]])
</code></pre></div>
<p>或者用颜色：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>   
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.colorbar.Colorbar instance at 0x10d8d7170&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_238_1.png" alt="png"></p>

<p><strong>评论</strong> : <code>numpy.ogrid</code> 函数允许直接创建上一个例子中两个<strong>重要纬度</strong>向量X和Y：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(array([[0],
        [1],
        [2],
        [3],
        [4]]), array([[0, 1, 2, 3, 4]]))
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">((5, 1), (1, 5))
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>因此， <code>np.ogrid</code> 就非常有用，只要我们是要处理网格计算。另一方面， 在一些无法（或者不想）从广播中收益的情况下，<code>np.mgrid</code>
直接提供了由索引构成的矩阵：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">x</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[0, 0, 0, 0],
       [1, 1, 1, 1],
       [2, 2, 2, 2],
       [3, 3, 3, 3]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">y</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[0, 1, 2, 3],
       [0, 1, 2, 3],
       [0, 1, 2, 3],
       [0, 1, 2, 3]])
</code></pre></div>
<h3>1.3.2.4数组形状操作</h3>

<h4>1.3.2.4.1 扁平</h4>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 2, 3, 4, 5, 6])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">T</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1, 4],
       [2, 5],
       [3, 6]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 4, 2, 5, 3, 6])
</code></pre></div>
<p>高维：后进先出。</p>

<h4>1.3.2.4.2 重排</h4>

<p>扁平的相反操作：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(2, 3)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1, 2, 3],
       [4, 5, 6]])
</code></pre></div>
<p>或者：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>    <span class="c"># 不确定的值（-1）将被推导</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1, 2, 3],
       [4, 5, 6]])
</code></pre></div>
<p><strong>警告</strong>： <code>ndarray.reshape</code> 可以返回一个视图（参见 <code>help(np.reshape)</code>）, 也可以可以返回副本</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[99,  2,  3],
       [ 4,  5,  6]])
</code></pre></div>
<p>当心：重排也可以返回一个副本！：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[ 0.,  0.],
       [ 0.,  0.],
       [ 0.,  0.]])
</code></pre></div>
<p>要理解这个现象，你需要了解更多关于numpy数组内存设计的知识。</p>

<h4>1.3.2.4.3 添加纬度</h4>

<p>用 <code>np.newaxis</code>对象进行索引可以为一个数组添加轴（在上面关于广播的部分你已经看到过了）：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">z</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 2, 3])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">z</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1],
       [2],
       [3]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[1, 2, 3]])
</code></pre></div>
<h4>1.3.2.4.4 纬度重组</h4>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(4, 3, 2)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">5
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(3, 2, 4)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">5
</code></pre></div>
<p>也是创建了一个视图：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">-1
</code></pre></div>
<h4>1.3.2.4.5 改变大小</h4>

<p>可以用 <code>ndarray.resize</code> 改变数组的大小：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">8</span><span class="p">,))</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([0, 1, 2, 3, 0, 0, 0, 0])
</code></pre></div>
<p>但是，它不能在其他地方引用：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">4</span><span class="p">,))</span>  
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

&lt;ipython-input-168-59edd3107605&gt; in &lt;module&gt;()
      1 b = a
----&gt; 2 a.resize((4,))


ValueError: cannot resize an array that references or is referenced
by another array in this way.  Use the resize function
</code></pre></div>
<p><strong>练习：形状操作</strong>
* 看一下 <code>reshape</code> 的文档字符串，特别要注意其中关于副本和视图的内容。
* 用 <code>flatten</code> 来替换 <code>ravel</code>。有什么区别？ (提示: 试一下哪个返回视图哪个返回副本)
* 试一下用 <code>transpose</code> 来进行纬度变换。</p>

<h3>1.3.2.5 数据排序</h3>

<p>按一个轴排序：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[3, 4, 5],
       [1, 1, 2]])
</code></pre></div>
<p><strong>注</strong>：每行分别排序！</p>

<p>原地排序：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[3, 4, 5],
       [1, 1, 2]])
</code></pre></div>
<p>象征索引排序：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">j</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([2, 3, 1, 0])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 2, 3, 4])
</code></pre></div>
<p>找到最大值和最小值：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">j_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">j_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">j_max</span><span class="p">,</span> <span class="n">j_min</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(0, 2)
</code></pre></div>
<p><strong>练习：排序</strong>
* 试一下原地和非原地排序
* 试一下用不同的数据类型创建数组并且排序。
* 用 <code>all</code> 或者  <code>array_equal</code> 来检查一下结果。
* 看一下 <code>np.random.shuffle</code>，一种更快创建可排序输入的方式。
* 合并 <code>ravel</code> 、<code>sort</code> 和 <code>reshape</code>。
* 看一下 <code>sort</code> 的 <code>axis</code> 关键字，重写一下这个练习。</p>

<h3>1.3.2.6 总结</h3>

<p><strong>入门你需要了解什么？</strong>
* 了解如何创建数组：<code>array</code>、<code>arange</code>、<code>ones</code>、<code>zeros</code>。
* 了解用 <code>array.shape</code>数组的形状，然后使用切片来获得数组的不同视图：<code>array[::2]</code>等。用 <code>reshape</code>改变数组形状或者用
<code>ravel</code>扁平化。
* 获得数组元素的一个子集，和/或用面具修改他们的值ay and/or modify their values with masks</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>
<ul>
<li>了解数组上各式各样的操作，比如找到平均数或最大值
(<code>array.max()</code>、<code>array.mean()</code>)。不需要记住所有东西，但是应该有条件反射去搜索文档 (线上文档, <code>help()</code>,<code>lookfor()</code>)!!</li>
<li>更高级的用法：掌握用整型数组索引，以及广播。了解更多的Numpy函数以便处理多种数组操作。</li>
</ul>

<p><strong>快读阅读</strong></p>

<p>如果你想要快速通过科学讲座笔记来学习生态系统，你可以直接跳到下一章：Matplotlib: 作图(暂缺)。</p>

<p>本章剩下的内容对于学习介绍部分不是必须的。但是，记得回来完成本章并且完成更多的练习。</p>

<h2>1.3.3 数据的更多内容</h2>

<h3>1.3.3.1 更多的数据类型</h3>

<h4>1.3.3.1.1 投射</h4>

<p>“更大”的类型在混合类型操作中胜出：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.5</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 2.5,  3.5,  4.5])
</code></pre></div>
<p>赋值不会改变类型！</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;int64&#39;)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.9</span>     <span class="c"># &lt;-- 浮点被截取为整数</span>
<span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 2, 3])
</code></pre></div>
<p>强制投射：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c"># &lt;-- 截取整数</span>
<span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 1, 1])
</code></pre></div>
<p>四舍五入：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">b</span>                    <span class="c"># 仍然是浮点</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 1.,  2.,  2.,  2.,  4.,  4.])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">c</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([1, 2, 2, 2, 4, 4])
</code></pre></div>
<h4>1.3.3.1.2 不同数据类型的大小</h4>

<p>整数 (带有符号):</p>

<p>|类型     |字节数|
|-------|------|
|int8   |8 bits|
|int16  |16 bits|
|int32  |32 bits (与32位平台的int相同)|
|int64  |64 bits (与64位平台的int相同)|</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">dtype(&#39;int64&#39;)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(2147483647, 2147483647)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(9223372036854775807, 9223372036854775807L)
</code></pre></div>
<p>无符号整数:</p>

<p>类型|字节数
-|-
uint8|8 bits
uint16|16 bits
uint32|32 bits
uint64|64 bits</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(4294967295, 4294967295)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">64</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(18446744073709551615L, 18446744073709551615L)
</code></pre></div>
<p>浮点数据：</p>

<p>类型|字节数
-|-
float16|16 bits
float32|32 bits
float64|64 bits (与浮点相同)
float96|96 bits, 平台依赖 (与 <code>np.longdouble</code> 相同)
float128|128 bits, 平台依赖 (与 <code>np.longdouble</code>相同)</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1.1920929e-07
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">2.2204460492503131e-16
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">True
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">False
</code></pre></div>
<p>浮点复数：</p>

<p>类型|字节数
-|-
complex64|两个 32-bit 浮点
complex128|两个 64-bit 浮点
complex192|两个 96-bit 浮点, 平台依赖
complex256|两个 128-bit 浮点, 平台依赖</p>

<p><strong>更小的数据类型</strong></p>

<p>如果你不知道需要特殊数据类型，那你可能就不需要。</p>

<p>比较使用 <code>float32</code>代替 <code>float64</code>:
* 一半的内存和硬盘大小
* 需要一半的宽带（可能在一些操作中更快）</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mf">1e6</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mf">1e6</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1000 loops, best of 3: 1.41 ms per loop
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">timeit</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1000 loops, best of 3: 739 µs per loop
</code></pre></div>
<ul>
<li>但是更大的四舍五入误差 - 有时在一些令人惊喜的地方（即，不要使用它们除非你真的需要）</li>
</ul>

<h3>1.3.3.2 结构化的数据类型</h3>

<p>名称|类型
-|-
sensor_code|(4个字母的字符)
position|(浮点)
value|(浮点)</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;sensor_code&#39;</span><span class="p">,</span> <span class="s">&#39;S4&#39;</span><span class="p">),(</span><span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)])</span>
<span class="n">samples</span><span class="o">.</span><span class="n">ndim</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">1
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(6,)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(&#39;sensor_code&#39;, &#39;position&#39;, &#39;value&#39;)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;ALFA&#39;</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;BETA&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;TAU&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>   <span class="mf">0.13</span><span class="p">),(</span><span class="s">&#39;ALFA&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;ALFA&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;TAU&#39;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">)]</span>
<span class="n">samples</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([(&#39;ALFA&#39;, 1.0, 0.37), (&#39;BETA&#39;, 1.0, 0.11), (&#39;TAU&#39;, 1.0, 0.13),
       (&#39;ALFA&#39;, 1.5, 0.37), (&#39;ALFA&#39;, 3.0, 0.11), (&#39;TAU&#39;, 1.2, 0.13)], 
      dtype=[(&#39;sensor_code&#39;, &#39;S4&#39;), (&#39;position&#39;, &#39;&lt;f8&#39;), (&#39;value&#39;, &#39;&lt;f8&#39;)])
</code></pre></div>
<p>用字段名称索引也可以访问字段：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[</span><span class="s">&#39;sensor_code&#39;</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([&#39;ALFA&#39;, &#39;BETA&#39;, &#39;TAU&#39;, &#39;ALFA&#39;, &#39;ALFA&#39;, &#39;TAU&#39;], 
      dtype=&#39;|S4&#39;)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([ 0.37,  0.11,  0.13,  0.37,  0.11,  0.13])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(&#39;ALFA&#39;, 1.0, 0.37)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;sensor_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;TAU&#39;</span>
<span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">(&#39;TAU&#39;, 1.0, 0.37)
</code></pre></div>
<p>一次多个字段：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[[</span><span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">]]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([(1.0, 0.37), (1.0, 0.11), (1.0, 0.13), (1.5, 0.37), (3.0, 0.11),
       (1.2, 0.13)], 
      dtype=[(&#39;position&#39;, &#39;&lt;f8&#39;), (&#39;value&#39;, &#39;&lt;f8&#39;)])
</code></pre></div>
<p>和普通情况一样，象征索引也有效：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">samples</span><span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="s">&#39;sensor_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ALFA&#39;</span><span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([(&#39;ALFA&#39;, 1.5, 0.37), (&#39;ALFA&#39;, 3.0, 0.11)], 
      dtype=[(&#39;sensor_code&#39;, &#39;S4&#39;), (&#39;position&#39;, &#39;&lt;f8&#39;), (&#39;value&#39;, &#39;&lt;f8&#39;)])
</code></pre></div>
<p><strong>注</strong>：构建结构化数组有需要其他的语言，见<a href="http://docs.scipy.org/doc/numpy/user/basics.rec.html">这里</a>和<a href="http://docs.scipy.org/doc/numpy/reference/arrays.dtypes.html#specifying-and-constructing-data-types">这里</a>。</p>

<h3>1.3.3.3 面具数组（maskedarray）: 处理缺失值（的传播）</h3>

<ul>
<li>对于浮点不能用NaN，但是面具对所有类型都适用：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">x</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">masked_array(data = [1 -- 3 --],
             mask = [False  True False  True],
       fill_value = 999999)
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">masked_array(data = [2 -- -- --],
             mask = [False  True  True  True],
       fill_value = 999999)
</code></pre></div>
<ul>
<li>通用函数的面具版本：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sqrt</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">masked_array(data = [1.0 -- 1.4142135623730951 --],
             mask = [False  True False  True],
       fill_value = 1e+20)
</code></pre></div>
<p><strong>注</strong>：有许多其他数组的<a href="http://scipy-lectures.github.io/advanced/advanced_numpy/index.html#array-siblings">兄弟姐妹</a></p>

<hr>

<p>尽管这脱离了Numpy这章的主题，让我们花点时间回忆一下编写代码的最佳实践，从长远角度这绝对是值得的：</p>

<p><strong>最佳实践</strong>
* 明确的变量名（不需要备注去解释变量里是什么）
* 风格：逗号后及＝周围有空格等。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">在[Python代码风格指南](http://www.python.org/dev/peps/pep-0008)及[文档字符串惯例](http://www.python.org/dev/peps/pep-0257)页面中给出了相当数据量如何书写“漂亮代码”的规则（并且，最重要的是，与其他人使用相同的惯例!）。
</code></pre></div>
<ul>
<li>除非在一些及特殊的情况下，变量名及备注用英文。</li>
</ul>

<h2>1.3.4 高级操作</h2>

<p>1.3.4.1. 多项式</p>

<p>Numpy也包含不同基的多项式：</p>

<p>例如，$3x^2 + 2x - 1$:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">-1
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span><span class="o">.</span><span class="n">roots</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([-1.        ,  0.33333333])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span><span class="o">.</span><span class="n">order</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">2
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;-&#39;</span><span class="p">)</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">[&lt;matplotlib.lines.Line2D at 0x10f40c2d0&gt;,
 &lt;matplotlib.lines.Line2D at 0x10f40c510&gt;]
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_341_1.png" alt="png"></p>

<p>更多内容见http://docs.scipy.org/doc/numpy/reference/routines.polynomials.poly1d.html。</p>

<h4>1.3.4.1.1 更多多项式（有更多的基）</h4>

<p>Numpy也有更复杂的多项式接口，支持比如切比雪夫基。</p>

<p>$3x^2 + 2x - 1$:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c"># 系数的顺序不同！</span>
<span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">-1.0
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([-1.        ,  0.33333333])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">p</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>  <span class="c"># 在普通的多项式中通常不暴露&#39;order&#39;</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">2
</code></pre></div>
<p>在切尔雪夫基中使用多项式的例子，多项式的范围在[-1,1]：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">Chebyshev</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r.&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;k-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">[&lt;matplotlib.lines.Line2D at 0x10f442d10&gt;]
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_347_1.png" alt="png"></p>

<p>切尔雪夫多项式在插入方面有很多优势。</p>

<h3>1.3.4.2 加载数据文件</h3>

<h4>1.3.4.2.1 文本文件</h4>

<p>例子: <a href="http://scipy-lectures.github.io/_downloads/populations.txt">populations.txt</a>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># year  hare    lynx    carrot
1900    30e3    4e3     48300
1901    47.2e3  6.1e3   48200
1902    70.2e3  9.8e3   41500
1903    77.4e3  35.2e3  38200
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;data/populations.txt&#39;</span><span class="p">)</span>
<span class="n">data</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">array([[  1900.,  30000.,   4000.,  48300.],
       [  1901.,  47200.,   6100.,  48200.],
       [  1902.,  70200.,   9800.,  41500.],
       [  1903.,  77400.,  35200.,  38200.],
       [  1904.,  36300.,  59400.,  40600.],
       [  1905.,  20600.,  41700.,  39800.],
       [  1906.,  18100.,  19000.,  38600.],
       [  1907.,  21400.,  13000.,  42300.],
       [  1908.,  22000.,   8300.,  44500.],
       [  1909.,  25400.,   9100.,  42100.],
       [  1910.,  27100.,   7400.,  46000.],
       [  1911.,  40300.,   8000.,  46800.],
       [  1912.,  57000.,  12300.,  43800.],
       [  1913.,  76600.,  19500.,  40900.],
       [  1914.,  52300.,  45700.,  39400.],
       [  1915.,  19500.,  51100.,  39000.],
       [  1916.,  11200.,  29700.,  36700.],
       [  1917.,   7600.,  15800.,  41800.],
       [  1918.,  14600.,   9700.,  43300.],
       [  1919.,  16200.,  10100.,  41300.],
       [  1920.,  24700.,   8600.,  47300.]])
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&#39;pop2.txt&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;pop2.txt&#39;</span><span class="p">)</span>

<span class="o">**</span><span class="err">注</span><span class="o">**</span><span class="err">：如果你有一个复杂的文本文件，应该尝试：</span>
<span class="o">*</span> <span class="sb">`np.genfromtxt`</span>
<span class="o">*</span> <span class="err">使用</span><span class="n">Python</span><span class="err">的</span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="err">函数和例如正则式来解析（</span><span class="n">Python</span><span class="err">特别适合这个工作）</span>

<span class="o">**</span><span class="err">提示：用</span><span class="n">IPython</span><span class="err">在文件系统中航行</span><span class="o">**</span>
</code></pre></div>
<p>pwd      # 显示当前目录
```</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">u&#39;/Users/cloga/Documents/scipy-lecture-notes_cn&#39;
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">cd data
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">/Users/cloga/Documents/scipy-lecture-notes_cn/data
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">ls
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">populations.txt
</code></pre></div>
<h4>1.3.4.2.2 图像</h4>

<p>使用Matplotlib：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">&#39;data/elephant.png&#39;</span><span class="p">)</span>
<span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">((200, 300, 3), dtype(&#39;float32&#39;))
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.image.AxesImage at 0x10fd13f10&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_357_1.png" alt="png"></p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;plot.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="s">&#39;red_elephant&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.figure.Figure at 0x10fba1750&gt;
</code></pre></div>
<p>这只保存了一个渠道（RGB）：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">&#39;red_elephant.png&#39;</span><span class="p">))</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.image.AxesImage at 0x11040e150&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_360_1.png" alt="png"></p>

<p>其他包：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">imsave</span>
<span class="n">imsave</span><span class="p">(</span><span class="s">&#39;tiny_elephant.png&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">[::</span><span class="mi">6</span><span class="p">,::</span><span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">&#39;tiny_elephant.png&#39;</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.image.AxesImage at 0x110bfbfd0&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_362_1.png" alt="png"></p>

<h4>1.3.4.2.3 Numpy的自有格式</h4>

<p>Numpy有自有的二进制格式，没有便携性但是I/O高效：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;pop.npy&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">data3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;pop.npy&#39;</span><span class="p">)</span>
</code></pre></div>
<h4>1.3.4.2.4 知名的（并且更复杂的）文件格式</h4>

<ul>
<li>HDF5: <a href="http://code.google.com/p/h5py/">h5py</a>, <a href="http://pytables.org/">PyTables</a></li>
<li>NetCDF: <code>scipy.io.netcdf_file</code>,
<a href="http://code.google.com/p/netcdf4-python/">netcdf4-python</a>, ...</li>
<li>Matlab: <code>scipy.io.loadmat</code>, <code>scipy.io.savemat</code></li>
<li>MatrixMarket: <code>scipy.io.mmread</code>, <code>scipy.io.mmread</code></li>
</ul>

<p>... 如果有人使用，那么就可能有一个对应的Python库。</p>

<p><strong>练习：文本数据文件</strong></p>

<p>写一个Python脚本从<a href="http://scipy-%0Alectures.github.io/_downloads/populations.txt">populations.txt</a>加载数据，删除前五行和后五行。将这个小数据集存入<code>pop2.txt</code>。</p>

<p><strong>Numpy内部</strong></p>

<p>如果你对Numpy的内部感兴趣, 有一个关于<a href="http://scipy-lectures.github.io/advanced/advanced_numpy/index.html#advanced-numpy">Advanced Numpy</a>的很好的讨论。</p>

<h2>1.3.5 一些练习</h2>

<h3>1.3.5.1 数组操作</h3>

<ul>
<li>从2D数组（不需要显示的输入）:</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">[[1,  6, 11],
 [2,  7, 12],
 [3,  8, 13],
 [4,  9, 14],
 [5, 10, 15]]
</code></pre></div>
<p>并且生成一个第二和第四行的新数组。</p>

<ul>
<li>将数组a的每一列以元素的方式除以数组b (提示: <code>np.newaxis</code>):</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</code></pre></div>
<ul>
<li>难一点的题目：创建10 X 3的随机数数组 （在[0, 1]的范围内）。对于每一行，挑出最接近0.5的数。

<ul>
<li>用 <code>abs</code>和 <code>argsort</code>找到每一行中最接近的列 <code>j</code>。</li>
<li>使用象征索引抽取数字。（提示：a[i,j]-数组 <code>i</code> 必须包含 <code>j</code> 中成分的对应行数）</li>
</ul></li>
</ul>

<h3>1.3.5.2 图片操作：给Lena加边框</h3>

<p>让我们从著名的Lena图（http://www.cs.cmu.edu/~chuck/lennapg/） 上开始，用Numpy数组做一些操作。Scipy在<code>scipy.lena</code>函数中提供了这个图的二维数组：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">misc</span>
<span class="n">lena</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
</code></pre></div>
<p><strong>注</strong>：在旧版的scipy中，你会在 <code>scipy.lena()</code>找到lena。</p>

<p>这是一些通过我们的操作可以获得图片：使用不同的颜色地图，裁剪图片，改变图片的一部分。</p>

<p><img src="http://scipy-lectures.github.io/_images/lenas.png" alt="lenas"></p>

<ul>
<li>让我们用pylab的 <code>imshow</code>函数显示这个图片。</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">lena</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.image.AxesImage at 0x110f51ad0&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_370_1.png" alt="png"></p>

<ul>
<li>Lena然后以为色彩显示。要将她展示为灰色需要指定一个颜色地图。</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.image.AxesImage at 0x110fb15d0&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_372_1.png" alt="png"></p>

<ul>
<li>用一个更小的图片中心来创建数组：例如，从图像边缘删除30像素。要检查结果，用 <code>imshow</code> 显示这个新数组。</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">crop_lena</span> <span class="o">=</span> <span class="n">lena</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">]</span>
</code></pre></div>
<ul>
<li>现在我们为Lena的脸加一个黑色项链形边框。要做到这一点，需要创建一个面具对应于需要变成黑色的像素。这个面具由如下条件定义 <code>(y-256)**2 +(x-256)**2</code></li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">]</span> <span class="c"># x 和 y 像素索引</span>
<span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">((512, 1), (1, 512))
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">centerx</span><span class="p">,</span> <span class="n">centery</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="c"># 图像中心</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">centery</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centerx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">230</span><span class="o">**</span><span class="mi">2</span> <span class="c"># 圆形</span>
</code></pre></div>
<p>接下来我们为面具对应的图片像素赋值为0。语句非常简单并且直觉化：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">lena</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.image.AxesImage at 0x113d33fd0&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_379_1.png" alt="png"></p>

<ul>
<li>接下来：将这个练习的所有命令复制到 <code>lena_locket.py</code> 脚本中，并且在IPython中用 <code>%run
lena_locket.py</code>执行这个脚本，将圆形改为椭圆。</li>
</ul>

<h3>1.3.5.3 数据统计</h3>

<p><a href="http://scipy-lectures.github.io/_downloads/populations.txt">populations.txt</a>中的数据描述了野兔和猞猁（以及胡罗比）在加拿大北部过去十年的数量：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;data/populations.txt&#39;</span><span class="p">)</span>
<span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c"># 技巧: 列到变量</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Hare&#39;</span><span class="p">,</span> <span class="s">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> 
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">&lt;matplotlib.legend.Legend at 0x1135d9510&gt;
</code></pre></div>
<p><img src="1.3NumPy_111_files/1.3NumPy_111_381_1.png" alt="png"></p>

<p>根据<a href="http://scipy-lectures.github.io/_downloads/populations.txt">populations.txt</a>中的数据计算并打印...</p>

<ol>
<li>每个物种在这个时间段内的数量平均数及标准差。</li>
<li>每个物种在哪一年数量最多。</li>
<li>每一年哪个物种数量最多。（提示：<code>np.array([&#39;H&#39;, &#39;L&#39;, &#39;C&#39;])</code>的<code>argsort</code> 和象征索引）</li>
<li>哪一年数量超过50000。（提示：比较和 <code>np.any</code>）</li>
<li>每个物种有最少数量的两年。（提示： <code>argsort</code>、象征索引）</li>
<li>比较（作图）野兔和猞猁总量的变化（看一下 <code>help(np.gradient)</code>）。看一下相关（见 <code>help(np.corrcoef)</code>）。</li>
</ol>

<p>... 所有都不应该使用for循环。</p>

<p>答案：<a href="http://scipy-lectures.github.io/_downloads/2_2_data_statistics.py">Python源文件</a></p>

<h3>1.3.5.4 粗略积分估计</h3>

<p>写一个函数  <code>f(a, b, c)</code> 返回$a^b - c$。组成一个24x12x6数组其中包含它值在参数范围[0,1] x [0,1] x [0,1]。</p>

<p>接近的3-D积分</p>

<p><img src="http://scipy-lectures.github.io/_images/math/7057c0b4df82c2659d776bcdc0eb1c9e16f61f9f.png" alt="math"></p>

<p>在这个体积之上有相同的平数。准确的结果是<img src="http://scipy-lectures.github.io/_images/math/13ff2c8691c09121c0bba41558b2ad22e55e077c.png" alt="result">...- 你的相对误差是多少？</p>

<p>（技巧：使用元素级别的操作和广播。你可以用 <code>np.ogrid</code> 获得在 <code>np.ogrid[0:1:20j]</code> 范围内的数据点。）</p>

<p><strong>提醒</strong>Python函数：</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">some_result</span>
</code></pre></div>
<p>答案：<a href="http://scipy-lectures.github.io/_downloads/2_3_crude_integration.py">Python源文件</a></p>

<h3>1.3.5.5 Mandelbrot集合</h3>

<p><img src="http://scipy-lectures.github.io/_images/2_4_mandelbrot.png" alt="mandelbrot"></p>

<p>写一个脚本计算Mandelbrot分形。Mandelbrot迭代</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">N_max</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">some_threshold</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1j</span><span class="o">*</span><span class="n">y</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N_max</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span>
</code></pre></div>
<p>点（x, y）属于Mandelbrot集合，如果|c| &lt; some_threshold。</p>

<p>作如下计算：</p>

<ul>
<li>构建一个网格 c = x + 1j*y， 值在范围[-2, 1] x [-1.5, 1.5]</li>
<li>进行迭代</li>
<li>构建2-D布尔面具标识输入集合中的点</li>
<li>用下列方法将结果保存到图片：</li>
</ul>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mandelbrot.png&#39;</span><span class="p">)</span>
</code></pre></div>
<p>答案：<a href="http://scipy-lectures.github.io/_downloads/2_4_mandelbrot.py">Python源文件</a></p>

<h3>1.3.5.6 马尔科夫链</h3>

<p><img src="http://scipy-lectures.github.io/_images/markov-chain.png" alt="markov-chain"></p>

<p>马尔可夫链过渡矩阵P以及在状态p的概率分布：
1. <code>0 &lt;= P[i,j] &lt;= 1</code>：从状态i变化到j的概率
2. 过度规则： $p<em>{new} = P^T p</em>{old}$
3. <code>all(sum(P, axis=1) == 1)</code>, <code>p.sum() == 1</code>: 正态化</p>

<p>写一个脚本产生五种状态，并且：
* 构建一个随机矩阵，正态化每一行，以便它是过度矩阵。
* 从一个随机（正态化）概率分布<code>p</code>开始，并且进行50步=&gt; <code>p_50</code>
* 计算稳定分布：P.T的特征值为1的特征向量（在数字上最接近1）=&gt; <code>p_stationary</code></p>

<p>记住正态化向量 - 我并没有...
* 检查一下 <code>p_50</code> 和 <code>p_stationary</code>是否等于公差1e-5</p>

<p>工具箱：<code>np.random.rand</code>、 <code>.dot()</code>、<code>np.linalg.eig</code>、reductions、<code>abs()</code>、<code>argmin</code>、compa
risons、<code>all</code>、<code>np.linalg.norm</code>等。</p>

<p>答案：<a href="http://scipy-lectures.github.io/_downloads/2_5_markov_chain.py">Python源文件</a></p>

    </div>

    
      <ul class="tag_box inline">
        <li><i class="icon-folder-open"></i></li>
        
        


  
     
    	<li><a href="/categories.html#python_scientific_lecture_notes-ref">
    		python_scientific_lecture_notes <span>4</span>
    	</a></li>
    
  


      </ul>
    

    
      <ul class="tag_box inline">
        <li><i class="icon-tags"></i></li>
        
        


  
     
    	<li><a href="/tags.html#Python-ref">Python <span>17</span></a></li>
    
  



      </ul>
    

    <hr>
    
    <ul class="pagination">
      
        <li class="prev"><a href="/python_scientific_lecture_notes/2014/12/22/python_language" title="1.2Python语言-Python科学讲座笔记">&larr; 上一页</a></li>
      
        <li><a href="/archive.html">归档列表</a></li>
      
        <li class="next disabled"><a>下一页 &rarr;</a>
      
    </ul>
    <hr>
    <!-- Paste the 3 next lines where you want the sharing button(s) to appear -->
    <div class="post-sharing">
     


  <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1654363" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1343300786690926" charset="utf-8"></script>
<!-- JiaThis Button END -->



    </div>    
    <div class="post-comments">
    


  <!-- UJian Button BEGIN -->
<div class="ujian-hook"></div>
<script type="text/javascript">var ujian_config = {num:12,picSize:84,textHeight:45};</script>
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?uid=1654363"></script>
<a href="http://www.ujian.cc" style="border:0;"><img src="http://img.ujian.cc/pixel.png" alt="友荐云推荐" style="border:0;padding:0;margin:0;" /></a>
<!-- UJian Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1654363"></script>
<!-- UY END -->



    </div>
  </div>
</div>


      <hr>
      <footer>
        <p>
          &copy; 2014 Cloga Chen
          <span class="pull-right text-muted">
            powered by
            <a href="http://jekyll-bootstrap-3.github.io" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll-Bootstrap-3</a>
            and <a href="http://getbootstrap.com" target="_blank">Twitter Bootstrap 3.0.3</a>
          </span>
        </p>
      </footer>
    </div>

    
    <script src="/assets/themes/bootstrap/resources/jquery/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-7VF4"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-7VF4');</script>
<!-- End Google Tag Manager -->


  </body>
</html>

